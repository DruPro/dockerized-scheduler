on:
  push:
    branches:
      - production

jobs:
  docker-start:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3  # This step is necessary to ensure the repo is checked out

    - name: Docker Setup Buildx
      uses: docker/setup-buildx-action@v3.7.1

    - name: Checking For Containers
      run: | 
        docker ps
        
    - name: Creating API|WEBSERVER|DATABASE|PROXY Containers
      run: | 
        docker build -t test_api:v1 ./API  # Correct path to the API directory # Building Images
        docker build -t test_web:v1 ./Web  # Correct path to the Web directory
        docker build -t test_database:v1 ./Backend  # Correct path to the Database directory 
        docker build -t test_proxy:v1 ./Proxy # Correct path to the Proxy directory 

        docker run --name api_instance -d test_api:v1 # Running containers from images
        echo "API Instance Is Succesfull" 
        docker run --name web_instance -d test_web:v1
        echo "WEB Instance Is Succesfull" 
        docker run --name database_instance -d test_database:v1
        echo "Database Instance Is Succesfull" 
        docker run --name proxy_instannce -d test_proxy:v1
        echo "Proxy Instance Is Succesfull" 
        docker ps

    - name: Closing API|WEBSERVER|DATABASE|PROXY Containers
      run: |
        echo "Closing API Container"
        docker stop api_instance  # Corrected syntax for stopping the container
        echo "Closing Web Container"
        docker stop web_instance  # Corrected syntax for stopping the container
        echo "Closing Database Container"
        docker stop database_instance  # Corrected syntax for stopping the container
        echo "Closing Proxy Container"
        docker stop proxy_instance  # Corrected syntax for stopping the container
